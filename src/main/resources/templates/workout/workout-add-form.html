<!DOCTYPE html>
<html layout:decorate="~{layout}" xmlns:layout="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8" />
</head>

<body>
    <section class="layout-content" layout:fragment="mybody">
        <h1>Workout Add</h1>
        <form th:action="@{/workout/add}" th:object="${workout}" method="POST">
            <!-- Workout Name -->
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Name" autofocus="autofocus"
                    th:field="*{name}" th:classappend="${#fields.hasErrors('name')} ? 'is-invalid'" />
                <div class="invalid-feedback">
                    <span th:errors="*{name}"></span>
                </div>
            </div>

            <!-- Workout Date -->
            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" class="form-control" id="date" placeholder="Date" th:field="*{date}"
                    th:classappend="${#fields.hasErrors('date')} ? 'is-invalid'" />
                <div class="invalid-feedback">
                    <span th:errors="*{date}"></span>
                </div>
            </div>


            <!-- Container for Added Workout Exercises -->
            <h2>Added Exercises</h2>
            <div id="workoutExercisesContainer">
                <!-- Dynamic exercise elements will be added here -->
            </div>

            <!-- Exercises -->
            <h2>Exercises</h2>
            <div id="exercisesContainer">
                <div th:each="exercise, stat : ${availableExercises}">
                    <div class="form-group">
                        <label th:for="${'exercise' + stat.index}">Exercise</label>
                        <input type="text" class="form-control" th:id="${'exercise' + stat.index}"
                            th:value="${exercise.name}" readonly />
                        <button type="button" th:data-exercise-id="${exercise.id}"
                            class="addExerciseBtn">Add</button>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-sm">Save</button>
        </form>
        <script>
            document.addEventListener('DOMContentLoaded', (event) => {
                document.getElementById('exercisesContainer').addEventListener('click', function(e) {
                    if(e.target && e.target.classList.contains('addExerciseBtn')) {
                        var exerciseId = e.target.getAttribute('data-exercise-id');
                        var container = document.getElementById('workoutExercisesContainer');
                        var newIndex = container.children.length;
        
                        // Create new div for workoutExercise
                        var newWorkoutExerciseDiv = document.createElement('div');
                        newWorkoutExerciseDiv.className = 'workoutExercise';
        
                        // Create and append hidden input for exercise ID
                        var exerciseIdInput = document.createElement('input');
                        exerciseIdInput.type = 'hidden';
                        exerciseIdInput.value = exerciseId;
                        exerciseIdInput.name = 'exerciseIds[' + newIndex + ']';
                        newWorkoutExerciseDiv.appendChild(exerciseIdInput);
        
                        // Create and append input for repetitions
                        var repetitionsInput = document.createElement('input');
                        repetitionsInput.type = 'number';
                        repetitionsInput.className = 'form-control';
                        repetitionsInput.placeholder = 'Repetitions';
                        repetitionsInput.name = 'repetitions[' + newIndex + ']';
                        newWorkoutExerciseDiv.appendChild(repetitionsInput);
        
                        container.appendChild(newWorkoutExerciseDiv);
                    }
                });
            });
        </script>
    </section>
    
</body>

</html>
